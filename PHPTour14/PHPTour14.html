<!DOCTYPE html>

<html>
<head>
  <title>Praspel, un langage de spécification par contrats (PHPTour'14, Lyon)</title>
  <meta http-equiv="content-type" content="text/html;       charset=utf-8" />
  <meta http-equiv="content-type" content="text/javascript; charset=utf-8" />
  <meta http-equiv="content-type" content="text/css;        charset=utf-8" />

  <link type="text/css" href="http://static.hoa-project.net/Css/Keynote.css" rel="stylesheet" />

  <style>
    .draw line {
        stroke: #000;
        stroke-width: 2;
    }

    .draw circle {
        fill: #000;
        stroke-width: 0;

    }

    .draw rect,
    .draw path {
        fill: none;
        stroke: #000;
        stroke-width: 1;
        stroke-linejoin: round;
    }

    .draw .arrow {
        fill: #000;
    }

    .draw rect {
        stroke-linecap: round;
    }

    text,
    .middle📌 {
        text-anchor: middle;
        dominant-baseline: middle;
    }

    .north📌 {
        text-anchor: middle;
        dominant-baseline: central;
        transform: translate(0, 1em);
    }

    .north-east📌 {
        text-anchor: end;
        dominant-baseline: central;
        transform: translate(-.5em, 1em);
    }

    .east📌 {
        text-anchor: end;
        dominant-baseline: central;
        transform: translate(-.5em, 0);
    }

    .south-east📌 {
        text-anchor: end;
        dominant-baseline: auto;
        transform: translate(-.5em, -.5em);
    }

    .south📌 {
        text-anchor: middle;
        dominant-baseline: auto;
        transform: translate(0, -.5em);
    }

    .south-west📌 {
        text-anchor: start;
        dominant-baseline: auto;
        transform: translate(.5em, -.5em);
    }

    .west📌 {
        text-anchor: start;
        dominant-baseline: central;
        transform: translate(.5em, 0);
    }

    .north-west📌 {
        text-anchor: start;
        dominant-baseline: central;
        transform: translate(.5em, 1em);
    }

    .draw .code-like {
        font-family: Pre;
        font-size: 12pt;
    }
  </style>
</head>
<body>

<script src="http://static.hoa-project.net/Javascript/Hoa.js"></script>

<section>
  <h1>Praspel, un langage de spécification par contrats</h1>

  <div class="tcenter">
    <img src="http://afup.org/templates/phptourlyon2014/medias/images/logo.png"
         alt="Logo du PHPTour"
         width="300px"
         class="center" />
    <p class="break"><small><time datetime="2014-06-24">24 juin 2014</time></small></p>
  </div>
</section>

<section>
  <h1>Qui sommes-nous ?</h1>

  <p>Ivan Enderlin :</p>
  <ul>
    <li>doctorant en Informatique
        (<a href="http://disc.univ-fcomte.fr/">DISC</a>,
         <a href="http://www.inria.fr/">INRIA</a>)</li>
    <li><em lang="en">leader</em> et développeur de
        <a href="http://hoa-project.net/">Hoa</a></li>
    <li>contributeur
        <a href="http://php.net/">PHP</a>,
        <a href="http://mozilla.org/">Mozilla</a>,
        <a href="http://debian.org/">Debian</a>,
        <a href="http://atoum.org/">atoum</a>… open-source</li>
    <li>expert invité au
        <a href="http://w3.org/">W3C</a> (HTML, CSS et WebApp)</li>
    <li><a href="https://twitter.com/hoaproject">@hoaproject</a>,
        <a href="irc://irc.freenode.net#hoaproject">#hoaproject</a></li>
  </ul>

  <p class="tcenter break">
    <math>
      <mrow>
        <mtext>ivan.enderlin@</mtext>
        <mo>{</mo>
        <mtable>
          <mtr>
            <mtd><mtext>hoa-project.net</mtext></mtd>
          </mtr>
          <mtr>
            <mtd><mtext>atoum.org</mtext></mtd>
          </mtr>
          <mtr>
            <mtd><mtext>inria.fr</mtext></mtd>
          </mtr>
        </mtable>
      </mrow>
    </math>
  </p>
</section>

<section>
  <h1>Qui sommes-nous ?</h1>

  <p>Julien Bianchi :</p>
  <ul>
    <li>développeur <a href="http://php.net/">PHP</a> &amp;
        <a href="http://resume.github.io/?jubianchi#mylanguages">…</a></li>
    <li>contributeur <a href="http://atoum.org/">atoum</a></li>
    <li>QA <a href="https://twitter.com/PMSIpilot">@PMSIpilot</a></li>
    <li>campeur
        <a href="irc://irc.freenode.net#hoaproject">#hoaproject</a>,
        <a href="irc://irc.freenode.net##atoum">##atoum</a></li>
  </ul>

  <p class="tcenter break">
  <math>
    <mrow>
      <mtext>@jubianchi</mtext>
      <mo>{</mo>
      <mtable>
        <mtr>
          <mtd><mtext>twitter.com</mtext></mtd>
        </mtr>
        <mtr>
          <mtd><mtext>github.com</mtext></mtd>
        </mtr>
      </mtable>
    </mrow>
  </math>
  <br />
  <math>
    <mrow>
      <mtext>julien.bianchi@</mtext>
      <mo>{</mo>
      <mtable>
        <mtr>
          <mtd><mtext>atoum.org</mtext></mtd>
        </mtr>
        <mtr>
          <mtd><mtext>hoa-project.net</mtext></mtd>
        </mtr>
      </mtable>
    </mrow>
  </math>
  </p>
</section>

<section>
  <h1>Définitions</h1>

  <div class="incremental">
    <p><em lang="en">System Under Test</em> (<strong>SUT</strong>) : système qui
    sera exécuté</p>
    <div class="break">
      <div class="fleft">
        <ul>
          <li data-item=" ">préambule</li>
          <li data-item="+">données</li>
          <li data-item="+">oracle</li>
          <li data-item="="><strong>cas de test</strong></li>
        </ul>
      </div>
      <div class="fright" style="width: 75%">
        <ul>
          <li data-item=":">place le SUT dans un état particulier</li>
          <li data-item=":"><strong>test</strong>, pour exécuter le SUT</li>
          <li data-item=":">établit le verdict, est-ce que le produit de
          l’exécution et l’état du SUT après son exécution sont ceux attendus ou
          non ?</li>
        </ul>
      </div>
    </div>
    <p class="break clear">Valeurs du verdict : <span class="👍">succès</span>,
                                                <span class="👎">échec</span> ou
                                                inconclusif</p>
    <p class="break"><strong>Suite de tests</strong> : ensemble de cas de tests</p>
  </div>
</section>

<section>
  <h1>Nature des tests</h1>

  <div class="schema">
    <svg width="700" height="400" viewBox="60 0 780 480" class="draw">

      <defs>
          <marker id="arrowHead"
                  viewBox="0 0 10 10" 
                  refX="1" refY="5"
                  markerWidth="6" 
                  markerHeight="6"
                  orient="auto">
              <path d="M 0 0 L 10 5 L 0 10 z" class="arrow" />
          </marker>
      </defs>

      <g class="incremental">
        <g>
          <line x1="375" y1="250" x2="375" y2="50"
                marker-end="url(#arrowHead)" />

          <text x="375" y="50" class="south-east📌">Taille du système</text>

          <circle cx="375" cy="210" r="3" />
          <circle cx="375" cy="170" r="3" />
          <circle cx="375" cy="130" r="3" />
          <circle cx="375" cy="90"  r="3" />

          <text x="375" y="210" class="east📌">Unitaire</text>
          <text x="375" y="170" class="east📌">Composant</text>
          <text x="375" y="130" class="east📌">Intégration</text>
          <text x="375" y="90"  class="east📌">Système</text>
        </g>

        <g>
          <line x1="375" y1="250" x2="650" y2="250"
                marker-end="url(#arrowHead)" />

          <text x="650" y="250" class="north-west📌">Support de</text>
          <text x="650" y="265" class="north-west📌">conception</text>

          <circle cx="465" cy="250" r="3" />
          <circle cx="565" cy="250" r="3" />

          <text x="465" y="235" class="south📌">Boîte</text>
          <text x="465" y="250" class="south📌">noire</text>
          <text x="565" y="235" class="south📌">Boîte</text>
          <text x="565" y="250" class="south📌">blanche</text>
        </g>

        <g transform="rotate(45 375 250)">
          <line x1="375" y1="250" x2="375" y2="450"
                marker-end="url(#arrowHead)" />

          <text x="375" y="450" class="north-west📌">Type de test</text>

          <circle cx="375" cy="290" r="3" />
          <circle cx="375" cy="330" r="3" />
          <circle cx="375" cy="370" r="3" />
          <circle cx="375" cy="410" r="3" />

          <text x="375" y="290" class="west📌">Fonctionnel</text>
          <text x="375" y="330" class="west📌">Robustesse</text>
          <text x="375" y="370" class="west📌">Performance</text>
          <text x="375" y="410" class="west📌">Utilisabilité</text>
        </g>
      </g>
    </svg>

    <div class="incremental">
      <p>Nous faisons du test boîte noire, unitaire et fonctionnel.</p>
    </div>
  </div>
</section>

<section>
  <h1><em lang="en">Design by Contract</em></h1>

  <div class="incremental">
    <div>
      <p>Contrat :</p>
      <ul>
        <li>inventé par B. Meyer en 1992 dans le langage Eiffel</li>
        <li>décrit un modèle en utilisant des annotations</li>
        <li>exprime des contraintes formelles : préconditions, postconditions et
        invariants</li>
      </ul>
    </div>
    <div>
      <ul>
        <li data-item="—"><em lang="en">caller</em> : « je m'engage à satisfaire ta
            précondition »</li>
        <li data-item="—"><em lang="en">callee</em> : « je m'engage à établir ma
            postcondition »</li>
        <li data-item="">invariants satisfaits avant et après l'exécution du
            <em lang="en">callee</em></li>
      </ul>
    </div>

    <div id="design_by_contract" class="verbatim schema"></div>
  </div>

  <script>
  Hoa.Document.onReady(function ( ) {

      var paper      = Hoa.Graph(Hoa.$('#design_by_contract'), 800, 150);
      var grid       = paper.grid(0, 0, 800, 150, 5, 1);
      var invariant1 = grid.push(paper.rect(0, 0, 140, 80, 3, 'invariants'));
      var pre        = grid.push(paper.rect(0, 0, 140, 80, 3, 'préconditions'));
      var method     = grid.push(paper.circle(0, 0, 25));
      var _method    = paper.text(400, 30, 'méthode');
      var post       = grid.push(paper.rect(0, 0, 140, 80, 3, 'postconditions'));
      var invariant2 = grid.push(paper.rect(0, 0, 140, 80, 3, 'invariants'));

      paper.link.between(invariant1, pre);
      paper.link.between(pre, method);
      paper.link.between(method, post);
      paper.link.between(post, invariant2);
  });
  </script>
</section>

<section>
  <h1>Langages de contrats</h1>

  <p>Chaque « grand » langage à un langage de contrat :</p>
  <ul>
    <li><em lang="en">Java Modeling Language</em> (JML) pour Java</li>
    <li><em lang="en">ANSI/C Specification Language</em> (ACSL) pour C</li>
    <li><em lang="en">Spec#</em> pour C#</li>
    <li><em lang="en">JSConTest</em> pour Javascript</li>
  </ul>
  <p class="break incremental"><span>Pour PHP ?</span> <span class="👎">Rien !</span></p>
</section>

<section>
  <h1><em lang="en">Contract-based Testing</em></h1>

  <div class="incremental">
    <div>
      <p>Principe :</p>
      <ul>
        <li>utilise les préconditions pour générer des données de tests</li>
        <li>utilise les postconditions et invariants pour établir le verdict du
            test à l'exécution, grâce à un <em lang="en">Runtime Assertion
            Checker</em> (RAC)</li>
      </ul>
    </div>

    <div>
      <p class="break">Problèmes :</p>
      <ul>
        <li>contraintes souvent exprimées avec des formules logiques</li>
        <li>difficile de générer de données</li>
      </ul>
    </div>
  </div>
</section>

<section>
  <h1>Contributions</h1>

  <p>Faire du <em lang="en">contract-based testing</em> en PHP en 3 étapes :</p>
  <ol>
    <li>un (nouveau) langage de contrats :
    <ul>
      <li>adapter à PHP</li>
      <li>pragmatique</li>
      <li>facile à utiliser pour le développeur</li>
      <li>assemblant plusieurs méthodes de test</li>
    </ul>
    </li>
    <li>des générateurs de données, pour tous les types usuels</li>
    <li>générer automatiquement des suites de tests unitaires</li>
  </ol>
</section>

<section>
  <h1>Agenda</h1>

  <ol>
    <li>Praspel et les domaines réalistes</li>
    <li>Génération automatique de données</li>
    <li>Génération automatique de tests unitaires</li>
    <li>Extension <code>atoum/praspel-extension</code></li>
    <li>Conclusion</li>
  </ol>
</section>

<section class="chapter">
  <h1>1 <span>Praspel et les domaines réalistes</span></h1>
</section>

<section>
  <h1>Domaines réalistes</h1>

  <div class="incremental">
  <div>
    <p>Naïvement, les domaines réalistes :</p>
    <ul>
      <li>raffinent les types usuels, comme les entiers, les chaînes de
      caractères, les tableaux etc.</li>
      <li>permettent d'exprimer des données plus complexes, comme des
      grammaires, des graphes etc.</li>
    </ul>
  </div>
  <div>
    <p class="break"><strong>Réaliste</strong> signifie qu'ils sont conçus pour
    spécifier des domaines de données pertinents pour un contexte spécifique ;
    exemple : une adresse email</p>
  </div>
  </div>
</section>

<section>
  <h1>Caractéristiques</h1>

  <p>Conçus pour répondre aux problématiques du test. Ils ont les deux
  caractéristiques suivantes :</p>
  <ul class="incremental">
    <li>la <strong>prédicabilité</strong> qui permet de valider qu'une donnée
    appartient à l'ensemble des valeurs décrites par le domaine réaliste</li>
    <li>la <strong>générabilité</strong> qui permet de générer une valeur
    décrite par le domaine réaliste</li>
  </ul>
</section>

<section>
  <h1>Implémentation</h1>

  <p><small>(Dans notre implémentation,)</small> un domaine réaliste est une classe</p>
  <p>Les caractéristiques sont représentées par les méthodes :</p>
  <ul>
    <li><code>predicate($q)</code> où <code>$q</code> est la valeur à valider</li>
    <li><code>sample($sampler)</code> où <code>$sampler</code> est un
    <strong>générateur numérique</strong> :  il génère uniquement des entiers et
    des réels, et permet de guider la génération d’une donnée ; par exemple,
    le générateur numérique est utilisé pour choisir un caractère parmi une
    plage de caractères donnée</li>
  </ul>
  <p>Seul générateur numérique disponible : pseudo-aléatoire</p>
</section>

<section>
  <h1>Hiérarchie</h1>

  <p>Classification verticale</p>
  <p>Héritage permet de raffiner les caractéristiques :</p>
  <ul>
    <li><code>Color</code> hérite de <code>String</code></li>
    <li><code>Boundinteger</code> hérite de <code>Integer</code></li>
    <li>tous sont enfants de la classe <code>Realdom</code></li>
  </ul>
  <p>Univers
     <math class="tex"><msub><mi mathvariant="normal">U</mi><mtext>realdom</mtext></msub></math> :</p>

  <svg width="640" height="190" viewBox="0 0 640 190" class="draw">

    <style>
      .fruit {
          stroke-dasharray: 3;
      }

      .structural > rect {
          stroke-width: 2;
      }
    </style>

    <g class="incremental">
      <g>
        <line x1="615" y1="180" x2="615" y2="20" marker-end="url(#arrowHead)" />
        <text x="630" y="95" transform="rotate(90 630 95)">héritage</text>
      </g>

      <g>
        <rect x="10" y="130" width="590" height="50" rx="10" ry="10" />
        <text x="285" y="155" class="code-like">undefined</text>
      </g>

      <g>
        <rect  x="10" y="70" width="90" height="50" rx="10" ry="10" />
        <rect x="110" y="70" width="90" height="50" rx="10" ry="10" />
        <rect x="210" y="70" width="90" height="50" rx="10" ry="10" />
        <rect x="310" y="70" width="90" height="50" rx="10" ry="10" />
        <text  x="55" y="95" class="code-like">boolean</text>
        <text x="155" y="95" class="code-like">integer</text>
        <text x="255" y="95" class="code-like">float</text>
        <text x="355" y="95" class="code-like">string</text>
      </g>

      <g class="structural">
        <rect x="410" y="70" width="90" height="50" rx="10" ry="10" />
        <rect x="510" y="70" width="90" height="50" rx="10" ry="10" />
        <text x="455" y="95" class="code-like">array</text>
        <text x="555" y="95" class="code-like">class</text>
      </g>

      <g class="fruit">
        <rect  x="10" y="10" width="290" height="50" rx="10" ry="10" />
        <text x="157" y="35">bibliothèque standard</text>
      </g>

      <g class="fruit">
        <rect x="310" y="10" width="290" height="50" rx="10" ry="10" />
        <text x="457" y="35">bibliothèque utilisateur</text>
      </g>
    </g>
  </svg>
</section>

<section>
  <h1>Paramètres</h1>

  <div class="incremental">
    <div>
      <p><em>A l'instar</em> des fonctions, un domaine réaliste est paramétrable :</p>
      <ul>
        <li>pour représenter des structures de données complexes (tableaux
        imbriqués, graphes, automates, arbres…)</li>
        <li>typage :
            <code class="language-php">'Integer size'</code></li>
        <li>multi-typage :
            <code class="language-php">'Integer|Float bigSize'</code></li>
        <li>valeur optionnelle :
            <code class="language-php">'Integer size' => 7</code></li>
        <li>utiliser la valeur par défaut : avec <code>default</code> ou
            <code>…</code></li>
      </ul>
    </div>
    <div>
      <p>Exemples d'appels :</p>
      <ul>
        <li><code>string('a', 'z', 4..12)</code></li>
        <li><code>string(…,…, 7)</code></li>
        <li><code>string('α', 'ω', 7)</code></li>
      </ul>
    </div>
  </div>
</section>

<section>
  <h1>Exemple</h1>

  <pre id="boundinteger"><code class="language-php">class        Boundinteger
  extends    Integer
  implements IRealdom\Interval,
             IRealdom\Finite,
             IRealdom\Nonconvex,
             IRealdom\Enumerable {

    protected $_arguments = [
        'Constinteger lower' => PHP_INT_MIN,
        'Constinteger upper' => PHP_INT_MAX
    ];

    public function predicate ( $q ) {

        return    parent::predicate($q)
               &amp;&amp; $q >= $this['lower']->getConstantValue()
               &amp;&amp; $q &lt;= $this['upper']->getConstantValue();
    }

    public function sample ( $sampler ) {

        return $sampler->getInteger(
            $this['lower']->sample($sampler),
            $this['upper']->sample($sampler)
        );
    }

    // ...
}</code></pre>
  <div class="incremental incremental-overlay">
    <p onincrement="Hoa.$('#boundinteger').hoa.highlightLines('1')">
       Implémentation : un domaine réaliste = une classe</p>
    <p onincrement="Hoa.$('#boundinteger').hoa.highlightLines('2')">
       Hiérarchie : <code>Boundinteger</code> hérite de <code>Integer</code></p>
    <p onincrement="Hoa.$('#boundinteger').hoa.highlightLines('3-6')">
       Classification : caractérisation du domaine réaliste</p>
    <p onincrement="Hoa.$('#boundinteger').hoa.highlightLines('8-11')">
       Paramètres : <code>lower</code> et <code>upper</code></p>
    <p onincrement="Hoa.$('#boundinteger').hoa.highlightLines('13-18')">
       Caractéristique de prédicabililité</p>
    <p onincrement="Hoa.$('#boundinteger').hoa.highlightLines('20-26')">
       Caractéristique de générabilité</p>
  </div>
</section>

<section>
  <h1>Classification</h1>

  <p>Classification transversale : horizontale</p>
  <p>Interfaces aidant à caractériser les domaines réalistes :</p>
  <ul>
    <li><code>Constant</code>, immuable avec une valeur (<code>42</code> du
    domaine réaliste <code>Constinteger</code>)</li>
    <li><code>Interval</code>, intervalle avec une borne inférieure et
    supérieure (qui peuvent être réduites dynamiquement)</li>
    <li><code>Finite</code>, ensemble de valeurs fini</li>
    <li><code>Nonconvex</code>,  avec des valeurs exclues (des trous)</li>
    <li><code>Enumerable</code>, dont les valeurs peuvent être énumérées</li>
  </ul>
</section>

<section>
  <h1>Bibliothèque standard</h1>

  <ul style="columns: 3; -moz-columns: 3; -webkit-columns: 3">
    <li><code>Undefined</code></li>
    <li><code>Array</code></li>
    <li><code>Boolean</code></li>
    <li><code>Class</code></li>
    <li><code>Float</code></li>
    <li><code>Integer</code></li>
    <li><code>String</code></li>
    <li><code>Bag</code></li>
    <li><code>Boundfloat</code></li>
    <li><code>Boundinteger</code></li>
    <li><code>Color</code></li>
    <li><code>Constarray</code></li>
    <li><code>Constboolean</code></li>
    <li><code>Constfloat</code></li>
    <li><code>Constinteger</code></li>
    <li><code>Constnull</code></li>
    <li><code>Conststring</code></li>
    <li><code>Date</code></li>
    <li><code>Empty</code></li>
    <li><code>Even</code></li>
    <li><code>Grammar</code></li>
    <li><code>Natural</code></li>
    <li><code>Number</code></li>
    <li><code>Object</code></li>
    <li><code>Odd</code></li>
    <li><code>Regex</code></li>
    <li><code>Smallfloat</code></li>
    <li><code>Smallinteger</code></li>
    <li><code>Timestamp</code></li>
  </ul>
</section>

<section>
  <h1>Praspel</h1>

  <p><em lang="en">PHP Realistic Annotation and SPEcification Language</em></p>
  <ul>
    <li>un langage et un <em lang="en">framework</em> de test à partir de
        <strong>contrats</strong></li>
    <li>un langage d'<strong>annotation</strong> (formellement un
        <em lang="en">Behavioral Interface Specification Language</em>), écrit
        dans les commentaires <code>/** … */</code></li>
    <li>permet d'exprimer des préconditions, postconditions et invariants</li>
    <li>inspiré de JML et ACSL, mais inspiré seulement</li>
    <li>utilise intensivement les domaines réalistes</li>
  </ul>
</section>

<section>
  <h1>Vue générale</h1>

  <pre id="overview"><code class="language-php">class C {

    /**
     * @invariant I;
     */
    protected $a;

    /**
     * @requires P;
     * @behavior α {
     *     @description 'Apply the α process.';
     *     @requires P_α;
     *     @behavior β {
     *         @requires  P_α_β;
     *         @ensures   Q_α_β;
     *         @throwable T_α_β;
     *     }
     * }
     * @behavior γ {
     *     @requires P_γ;
     *     …
     * }
     * @default {
     *     @description 'Apply the fallback process.';
     *     @ensures   Q_D;
     *     @throwable T_D;
     * }
     */
     public function f ( ) { }
}</code></pre>
  <div class="incremental incremental-overlay">
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('4')">
       <code>@invariant</code> exprime un invariant</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('9,12,14,20')">
       <code>@requires</code> exprime une précondition</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('15,25')">
       <code>@ensures</code> exprime une postcondition normale</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('16,26')">
       <code>@throwable</code> exprime une postcondition exceptionnelle ;
       de la forme <code>T_C with T_E</code></p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('10,19')">
       <code>@behavior</code> exprime un comportement</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('23')">
       <code>@default</code> exprime un comportement par défaut, avec une clause
       <code>@requires</code> implicite</p>
    <p onincrement="Hoa.$('#overview').hoa.highlightLines('11,24')">
       <code>@description</code> décrit informellement un comportement</p>
  </div>
</section>

<section>
  <h1>Expressions</h1>

  <p><code>P</code>, <code>Q</code> et <code>T_E</code> représente une
  expressions :</p>
  <ul>
    <li>une déclaration</li>
    <li>un prédicat</li>
    <li>une qualification</li>
  </ul>
  <div class="incremental incremental-overlay">
    <div>
      <p>Déclaration :</p>
      <ul>
        <li>associe un ou plusieurs domaines réalistes à une variable du SUT
        (arguments) ou du modèle (<code>let</code>)</li>
        <li>plusieurs = disjonction de domaines réalistes</li>
        <li><code>\result</code> représente le résultat du SUT</li>
        <li><code>\old(<em>i</em>)</code> représente la valeur de
        <code><em>i</em></code> dans le pré-état (avant l'exécution du SUT)</li>
      </ul>
    </div>
    <div>
      <pre><code class="language-php">// Add an example</code></pre>
    </div>

    <div>
      <p>Prédicat : </p>
      <ul>
        <li>toutes les constructions de Praspel supportent la
        <strong>validation</strong> et la <strong>génération</strong> mais…</li>
        <li>toutes les contraintes ne peuvent pas être exprimées</li>
        <li><code>\pred(<code><em>p</em></code>)</code> où
        <code><em>p</em></code> est du code PHP pur (en forme normale
        conjonctive, CNF)</li>
      </ul>
    </div>
    <div>
      <pre><code class="language-php">// Add an example</code></pre>
    </div>

    <div>
      <p>Qualification :</p>
      <ul>
        <li>qualifier une donnée avec un adjectif</li>
        <li>« mot-clé » représentant des constraintes usuelles</li>
        <li>facilite la vie, facile à lire, évite les erreurs</li>
      </ul>
    </div>
    <div>
      <pre><code class="language-php">// Add an example</code></pre>
    </div>
  </div>
</section>

<section>
  <h1>Exemples</h1>
</section>

<section class="chapter">
  <h1>2 <span>Génération automatique de données</span></h1>
</section>

<section>
  <h1>Génération standard</h1>

  <p>Génération par défaut</p>
  <p>Totalement pseudo-aléatoire</p>
  <p><math class="tex">
       <mi mathvariant="normal">V</mi>
     </math> l'ensemble des variables (des préconditions et
  invariants)</p>
  <p><math class="tex">
       <mi mathvariant="normal">v</mi>
       <mo>∈</mo>
       <mi mathvariant="normal">V</mi>
     </math> une variable de la forme : <code>v: t_1(…) or … or t_n(…)</code></p>
  <div id="standard_generation" class="verbatim schema" style="width: 300px"></div>
  <script>
  Hoa.Document.onReady(function ( ) {

      var paper      = Hoa.Graph(Hoa.$('#standard_generation'), 300, 300);
      var grid       = paper.grid(0, 0, 300, 300, 3, 3);

      var pick      = grid.push(paper.circle(0, 0, 20), 1, 0);
      var sample    = grid.push(paper.circle(0, 0, 20), 0, 1);
      var predicate = grid.push(paper.circle(0, 0, 20), 1, 2);
      var pred      = grid.push(paper.circle(0, 0, 20), 2, 1);

//      paper.arc.between(pick, sample);
//      paper.arc.between(sample, predicate);
//      paper.arc.between(predicate, pred);
//      paper.arc.between(pred, pick);


//      var invariant1 = grid.push(paper.rect(0, 0, 140, 80, 3, 'invariants'));
//      var pre        = grid.push(paper.rect(0, 0, 140, 80, 3, 'préconditions'));
//      var method     = grid.push(paper.circle(0, 0, 25));
//      var _method    = paper.text(400, 30, 'méthode');
//      var post       = grid.push(paper.rect(0, 0, 140, 80, 3, 'postconditions'));
//      var invariant2 = grid.push(paper.rect(0, 0, 140, 80, 3, 'invariants'));
//
//      paper.link.between(invariant1, pre);
//      paper.link.between(pre, method);
//      paper.link.between(method, post);
//      paper.link.between(post, invariant2);
  });
  </script>
</section>

<section>
  <h1>Génération de tableaux</h1>

  <ol>
    <li>étude des propriétés les plus populaires sur les tableaux (sur plus de
        60 projets, plus 5 millions de LOC) ; retenues :</p>
        <ul>
          <li><code>count</code></li>
          <li><code>array_key_exists</code></li>
          <li><code>in_array</code></li>
        </ul>
    </li>
    <li><small>(syntaxe)</small> extension de Praspel pour les inclure
        nativement</li>
    <li><small>(sémantique)</small> transformation en propriétés
         ensemblistes</li>
    <li>solveur ensembliste</li>
  </ol>
</section>

<section>
  <h1>Syntaxe des propriétés</h1>

  <p>Déclaration de tableau :
     <code>a: array(<math class="tex"><mi mathvariant="normal">D</mi></math>,
                    <math class="tex"><mi mathvariant="normal">L</mi></math>)</code></p>

  <div class="incremental incremental-overlay break">
    <div>
      <p>Paire :
         <code>a[<math class="tex"><mi mathvariant="normal">K</mi></math>]:
               <math class="tex"><mi mathvariant="normal">V</mi></math></code></p>
      <ul>
        <li>toute valeur dans
            <math class="tex"><mi mathvariant="normal">K</mi></math> est la clé
            d'une paire dans le tableau <code>a</code></li>
        <li>toute paire dont la clé est dans
            <math class="tex"><mi mathvariant="normal">K</mi></math> a sa valeur
            dans <math class="tex"><mi mathvariant="normal">V</mi></math></li>
      </ul>
      <p>Exemple :</p>
      <pre><code>a[7..8]: true or 42</code></pre>
      <p>équivaut à :</p>
      <pre><code class="language-php">   array_key_exists(7, $a)
&amp;&amp; array_key_exists(8, $a)
&amp;&amp; (in_array(true, $a) || in_array(42, $a))
&amp;&amp; ($a[7] === true     || $a[7] === 42)
&amp;&amp; ($a[8] === true     || $a[8] === 42)</code></pre>
    </div>
    <div>
      <p>Clé :
         <code>a[<math class="tex"><mi mathvariant="normal">K</mi></math>]: _</code></p>
      <ul>
        <li>toute valeur de
            <math class="tex"><mi mathvariant="normal">K</mi></math> doit être
            une clé du tableau <code>a</code></li>
      </ul>
      <p>Exemple :</p>
      <pre><code>a[7..8]: _</code></pre>
      <p>équivaut à :</p>
      <pre><code class="language-php">   array_key_exists(7, $a)
&amp;&amp; array_key_exists(8, $a)</code></pre>
    </div>
    <div>
      <p>Valeur :
         <code>a[_]: <math class="tex"><mi mathvariant="normal">V</mi></math></code></p>
      <ul>
        <li>toute valeur de
            <math class="tex"><mi mathvariant="normal">V</mi></math> doit être
            une valeur du tableau <code>a</code></li>
      </ul>
      <p>Exemple :</p>
      <pre><code>a[_]: 'foo'</code></pre>
      <p>équivaut à :</p>
      <pre><code class="language-php">in_array('foo', $a)</code></pre>
    </div>
    <div>
      <p>Unicité : <code>a is unique</code></p>
      <ul>
        <li>toutes les clés sont uniques (intrinsèque au tableau)</li>
        <li>toutes les valeurs sont uniques</li>
      </ul>
      <p>Exemple :</p>
      <pre><code>a is unique</code></pre>
      <p>équivaut à :</p>
      <pre><code class="language-php">// for simple cases
count($a) === count(array_unique($a, SORT_REGULAR))</code></pre>
    </div>
    <div>
      <p>Mais aussi…</p>
      <p><code>a[<math class="tex"><mi mathvariant="normal">K</mi></math>]!:
               <math class="tex"><mi mathvariant="normal">V</mi></math></code></p>
      <ul>
        <li>toute valeur de
            <math class="tex"><mi mathvariant="normal">K</mi></math> est la clé
            d'une paire dans le tableau <code>a</code></li>
        <li>toute paire dont la clé est dans
            <math class="tex"><mi mathvariant="normal">K</mi></math> n'a pas sa
            valeur dans <math class="tex"><mi mathvariant="normal">V</mi></math></li>
      </ul>
      <p><code>a[<math class="tex"><mi mathvariant="normal">K</mi></math>]!: _</code></p>
      <ul>
        <li>aucune paire du tableau <code>a</code> n'a sa clé dans
           <math class="tex"><mi mathvariant="normal">K</mi></math></li>
      </ul>
      <p><code>a[_]!: <math class="tex"><mi mathvariant="normal">V</mi></math></code></p>
      <ul>
        <li>…</li>
      </ul>
    </div>
  </div>
</section>

<section>
  <h1>Sémantique ensemblistes</h1>

  <p class="break">Un <em lang="en">Constraint Satisfaction Problem</em> et
     un triplet
     <math class="tex">
       (
       <mi mathvariant="normal">Σ</mi>,
       <mi mathvariant="normal">Δ</mi>,
       <mi mathvariant="normal">Π</mi>
       )
     </math> où…</p>
  <p class="break">Les variables
     <math class="tex">
       <mi mathvariant="normal">σ</mi>
       <mo>∈</mo>
       <mi mathvariant="normal">Σ</mi>
     </math> sont
     la taille <math class="tex"><mi mathvariant="normal">S</mi></math>,
     les ensembles <math class="tex"><mi mathvariant="normal">X</mi></math> et
     <math class="tex"><mi mathvariant="normal">Y</mi></math>,
     la fonction totale
     <math class="tex"><mi mathvariant="normal">H</mi></math>…</p>
  <p class="break">Cardinalité :
     <math class="tex">
       <mi>card</mi>
       (
       <mi mathvariant="normal">X</mi>
       )
       <mo>=</mo>
       <mi mathvariant="normal">S</mi>
     </math>,
     <math class="tex">
       <mi mathvariant="normal">S</mi>
       <mo>≥</mo>
       <mn>0</mn>
     </math>,
     <math class="tex">
       <mi>card</mi>
       (
       <mi mathvariant="normal">X</mi>
       )
       <mo>≥</mo>
       <mi>card</mi>
       (
       <mi mathvariant="normal">Y</mi>
       )
     </math>
     …</p>
  <p class="break">Domaines et co-domaines :
     <math class="tex">
       <mi mathvariant="normal">Y</mi>
       <mo>=</mo>
       <mover accent="true">
         <mi mathvariant="normal">H</mi>
         <mo>^</mo>
       </mover>
       (
       <mi mathvariant="normal">X</mi>
       )
     </math>,
     <math class="tex">
       <mi mathvariant="normal">X</mi>
       <mo>=</mo>
       <munder>
         <mo>∪</mo>
         <mrow style="font-size: small">
          <mn>1</mn>
          <mo>≤</mo>
          <mi mathvariant="normal">i</mi>
          <mo>≤</mo>
          <mi mathvariant="normal">j</mi>
         </mrow>
       </munder>
       <msub>
         <mi mathvariant="normal">X</mi>
         <mi mathvariant="normal">i</mi>
       </msub>
     </math>…</p>
  <p class="break">Paires :
     <math class="tex">
       <mi mathvariant="normal">K</mi>
       <mo>⊆</mo>
       <mi mathvariant="normal">X</mi>
     </math>,
     <math class="tex">
       <mover accent="true">
         <mi mathvariant="normal">H</mi>
         <mo>^</mo>
       </mover>
       (
       <mi mathvariant="normal">K</mi>
       )
       <mo>⊆</mo>
       <mi mathvariant="normal">V</mi>
     </math>,
     <math class="tex">
       <mover accent="true">
         <mi mathvariant="normal">H</mi>
         <mo>^</mo>
       </mover>
       (
       <mi mathvariant="normal">K</mi>
       )
       <mo>∩</mo>
       <mi mathvariant="normal">V</mi>
       <mo>=</mo>
       <mo>∅</mo>
     </math>…</p>
  <div style="position: absolute;
              top: 50%;
              left: 0;
              right: 0;
              text-align: center;
              font-family: Pre;
              font-size: 6em;
              font-weigh: bold;
              color: red;
              transform: rotate(-45deg)">
    censored
  </div>
</section>

<section>
  <h1>Solveur ensembliste</h1>

  <p>Fonctionne en deux étapes :</p>
  <ul>
    <li>propagation et consistance (basée sur un algorithme AC3)</li>
    <li><em lang="en">labelling</em></li>
  </ul>
  <p>Exemple :</p>
  <pre><code>length: 0..5 or 10
a     : array([to string('a', 'e', 1)], length)
a[0]  : 'b' or 'c'
a is unique</code></pre>
  <p>a comme solution possible :</p>
  <pre data-line="2"><code class="language-php">[
    0 => 'c',
    1 => 'd',
    2 => 'a',
    3 => 'e'
]</code></pre>
</section>

<section>
  <h1>Génération de chaînes de caractères</h1>
</section>

<section>
  <h1>Génération d'objets</h1>
</section>

<section class="chapter">
  <h1>3 <span>Génération automatique de tests unitaires</span></h1>
</section>

<section>
  <h1>Objectifs de tests</h1>
</section>

<section>
  <h1>Critère de couvertures sur les contrats</h1>
</section>

<section>
  <h1>Génération de suites de tests atoum</h1>
</section>

<section class="chapter">
  <h1>4 <span>Extension<br /><small><code>atoum/praspel-extension</code></span></small></h1>
</section>

<section>
  <h1>Des nouveaux « <em lang="en">asserters</em> »</h1>
</section>

<section>
  <h1>Génération de données</h1>
</section>

<section class="chapter">
  <h1>5 <span>Conclusion</span></small></h1>
</section>

<section>
  <h1>Outillage</h1>
</section>

<section>
  <h1>Quelques liens</h1>

  <ul>
    <li>thèse : …</li>
    <li>documentation : …</li>
    <li>extension atoum : …</li>
  </ul>
</section>

<section class="chapter">
  <h1>Merci ! <span>☺︎</span></h1>

  <p class="tcenter">
    <a href="http://hoa-project.net/">hoa-project.net</a>
    <br />
    <a href="https://twitter.com/hoaproject">@hoaproject</a>
  </p>
</section>

<div id="progress-bar"></div>

<script src="http://static.hoa-project.net/Javascript/Keynote.js"></script>
<script src="http://static.hoa-project.net/Javascript/Prism.js"></script>
<script src="http://static.hoa-project.net/Javascript/Prism.hoa.js"></script>
<script src="http://static.hoa-project.net/Javascript/Prism.plugin.line.js"></script>
<script src="http://static.hoa-project.net/Javascript/Hoa.Graph.js"></script>
<script src="http://static.hoa-project.net/Javascript/Hoa.Graph.style.js"></script>
<script>
  Hoa.namespace([HTMLElement], {

      guard: function ( ) {

          return true;
      },
      body : function ( element ) {

          return {

              highlightLines: function ( lines ) {

                  element.setAttribute('data-line', lines);
                  Prism.hooks.run(
                      'after-highlight',
                      {
                          element: element.querySelector('code')
                      }
                  );
              }
          };
      }
  });
</script>

</body>
</html>
