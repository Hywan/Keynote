<!DOCTYPE html>

<html>
<head>
  <title>Hoa, un ensemble de bibliothèques PHP (AFUP Lyon'13, Lyon)</title>
  <meta http-equiv="content-type" content="text/html;       charset=utf-8" />
  <meta http-equiv="content-type" content="text/javascript; charset=utf-8" />
  <meta http-equiv="content-type" content="text/css;        charset=utf-8" />

  <link type="text/css" href="http://static.hoa-project.net/Css/Keynote.css" rel="stylesheet" />
</head>
<body>

<script src="http://static.hoa-project.net/Javascript/Hoa.js"></script>

<!--

modulaires
extensibles
structurées
rolling-release

-->

<section>
  <h1>Hoa, un ensemble de bibliothèques PHP</h1>

  <div class="tcenter">
    <img src="Image/AFUPLyon.png"
         alt="Logo de l'AFUP Lyon"
         width="400px"
         class="center" />
  </div>
</section>

<section>
  <h1>Qui sommes-nous ?</h1>

  <p>Ivan Enderlin :</p>
  <ul>
    <li>doctorant en Informatique
        (<a href="http://disc.univ-fcomte.fr/">DISC</a>,
         <a href="http://www.inria.fr/">INRIA</a>)</li>
    <li><em lang="en">leader</em> et développeur de Hoa</li>
    <li>contributeur
        <a href="http://php.net/">PHP</a>,
        <a href="http://mozilla.org/">Mozilla</a>,
        <a href="http://debian.org/">Debian</a>,
        <a href="http://atoum.org/">atoum</a>… open-source</li>
    <li>expert invité au
        <a href="http://w3.org/">W3C</a> (HTML, CSS et WebApp)</li>
    <li><a href="https://twitter.com/hoaproject">@hoaproject</a>,
        <a href="irc://irc.freenode.net#hoaproject">#hoaproject</a></li>
  </ul>

  <math>
    <mrow>
      <mtext>ivan.enderlin@</mtext>
      <mo>{</mo>
      <mtable>
        <mtr>
          <mtd><mtext>hoa-project.net</mtext></mtd>
        </mtr>
        <mtr>
          <mtd><mtext>atoum.org</mtext></mtd>
        </mtr>
        <mtr>
          <mtd><mtext>inria.fr</mtext></mtd>
        </mtr>
      </mtable>
    </mrow>
  </math>
</section>

<section>
  <h1>Qui sommes-nous ?</h1>

  <p>Julien Bianchi</p>
  <ul>
    <li>foo</li>
    <li>bar</li>
    <li>baz</li>
    <li>qux</li>
  </ul>

  <math>
    <mrow>
      <mtext>julien.bianchi@</mtext>
      <mo>{</mo>
      <mtable>
        <mtr>
          <mtd><mtext>atoum.org</mtext></mtd>
        </mtr>
        <mtr>
          <mtd><mtext>hoa-project.net</mtext></mtd>
        </mtr>
        <mtr>
          <mtd><mtext>…</mtext></mtd>
        </mtr>
      </mtable>
    </mrow>
  </math>
</section>

<section>
  <h1>Bibliothèque</h1>

  <q>Une bibliothèque est un ensemble de fonctionnalités dédiées à la résolution
  d'un problème précis et isolé, grâce à son abstraction la plus élevée</q>
  <q>L'abstraction permet de s'adapter à plus de formes de problèmes</q>
  <p>La Force est dans l'abstraction</p>
</section>

<section>
  <h1>Contributions</h1>

  <p>Hoa :</p>
  <ul>
    <li>un ensemble de bibliothèques PHP <strong>modulaires</strong>,
    <strong>extensibles</strong> et <strong>structurées</strong></li>
    <li>un pont entre le monde de la recherche et de l'industrie</li>
    <li>un environnement pour développer des bibliothèques</li>
  </ul>
</section>

<section>
  <h1>Agenda</h1>

  <ol>
    <li>Présentation du projet</li>
    <li>Quelques fondamentaux de Hoa</li>
    <li>Bibliothèques phares</li>
    <li>Conclusion</li>
  </ol>
</section>

<section class="chapter">
  <div>1</div>
</section>

<section>
  <h1>Projets distribués<sup>*</sup></h1>

  <ul>
    <li><code>Central</code> : l'ensemble de toutes les bibliothèques Hoa
    (standards) et Hoathis (utilisateurs)</li>
    <li><code>Library/<em>*</em></code> : bibliothèques isolées</li>
    <li><code>Literature</code> : manuels et une partie de la documentation</li>
    <li><code>Keynote</code> : toutes les présentations</li>
    <li><code>W3</code> et <code>Static</code> : le site Web de Hoa</li>
    <li><code>Bhoat</code> : le robot qui maintient les différents projets de
    Hoa</li>
  </ul>
  <p><small><sup>*</sup> liste non exhaustive !</small></p>
</section>

<section>
  <h1>Sources<small>, e.g. <code>Hoa\Core</code></small></h1>

  <p><img src="http://static.hoa-project.net/Image/Logo/Git.png"
          alt="Git"
          class="fright" style="height: 1.3em" />
     <em>Via</em> <a href="http://git-scm.com/">Git</a>,
     <code><em>project</em>.git</code> :</p>
  <pre><code class="language-shell">$ git clone http://git.hoa-project.net/Library/Core.git</code></pre>

  <p><img src="http://static.hoa-project.net/Image/Logo/Github.png"
          alt="Github"
          class="fright" style="height: 1.8em" />
     <em>Via</em> <a href="https://github.com/hoaproject/">Github</a>,
     sans <code>Library/</code> :</p>
  <pre><code class="language-shell">$ git clone https://github.com/hoaproject/Core.git</code></pre>

  <p><img src="http://static.hoa-project.net/Image/Logo/Composer.png"
          alt="Composer"
          class="fright" style="height: 1.8em" />
     <em>Via</em> <a href="http://getcomposer.org/">Composer</a>,
     avec le schéma :</p>
  <pre><code class="language-json">{ "require": { "hoa/core": "dev-master" }, "minimum-stability": "dev" }</code></pre>
  <p>… puis :</p>
  <pre><code class="language-shell">$ composer install</code></pre>

  <p><em>Via</em> les archives sur
     <a href="http://download.hoa-project.net">download.hoa-project.net</a></p>
</section>

<section>
  <h1>Bibliothèques</h1>

  <ul>
    <li>sources à la racine</li>
    <li><code>Bin/</code> accessible <em>via</em> <code>hoa
    <em>library</em>:<em>command</em></code></li>
    <li><code>Documentation/</code> pour le <em lang="en">hack book</em></li>
    <li><code>Test/</code> pour les tests</li>
    <li><code>README.md</code>, description et exemples</li>
    <li><code>composer.json</code> pour Composer</li>
  </ul>
  <div id="library_states" class="schema"></div>
  <script>
  Hoa.Document.onReady(function ( ) {

      var paper = Hoa.Graph(Hoa.$('#library_states'), 600, 150);
      var grid  = paper.grid(0, 0, 600, 150, 3, 1);
      var step1 = grid.push(paper.rect(0, 0, 120, 90, 3, 'existantes'));
      var step2 = grid.push(paper.rect(0, 0, 120, 90, 3, 'matures'));
      var step3 = grid.push(paper.rect(0, 0, 120, 90, 3, 'finalisées'));

      paper.link.between(step1, step2);
      paper.link.between(step2, step3);
  });
  </script>

</section>

<section>
  <h1>Rolling-release</h1>
</section>

<section>
  <h1>Quelques chiffres<sup>*</sup></h1>

  <p>Nombre de :</p>
  <ul>
    <li>bibliothèques : > 50 (dont 15 finalisées)</li>
    <li>fichiers : 565</li>
    <li>lignes de code : ≃ 107 000</li>
    <li><em lang="en">commits</em> : > 1 700</li>
    <li>contributeurs : 27</li>
    <li>installations <em>via</em> Packagist <small>(depuis septembre
    2012)</small> : > 43 000</li>
    <li>sur Github : > 180 <em lang="en">forks</em> et 155 ★</li>
  </ul>
  <p><small><sup>*</sup> entre le 1 janvier 2013 et aujourd'hui</small></p>
</section>

<section>
  <h1>Litératures</h1>

  <p><a href="http://hoa-project.net/Literature.html">Documentations</a> :</p>
  <ul>
    <li>mini-tutoriel</li>
    <li>manuel d'apprentissage : 9 chapitres</li>
    <li><em lang="en">hack book</em> : 15 chapitres</li>
  </ul>
  <p><a href="http://hoa-project.net/Awecode.html">Awecode</a> : quand le code
     rencontre la vidéo</p>
  <p><a href="http://hoa-project.net/Literature.html#Recherche">Recherche</a> :
      3 articles en conférences internationales</p>
  <p>Autres événements communutaires, industriels <small>(dont 2 par l'AFUP,
  merci !)</small>, formations etc.</p>
  <p><small>(traduction en cours vers l'anglais)</small></p>
</section>

<section>
  <h1>Communauté</h1>

  <ul>
    <li>3 pays : France, Suisse et Belgique <small>(+ 2 autres pays
    ponctuellement)</small></li>
    <li>IRC : irc.freenode.org #hoaproject</li>
    <li>Mailing-lists</li>
    <li><a href="http://hoa-project.net/Foundation.html">Association</a> à but
    non-lucratif, objectifs :
    <blockquote>soutenir le projet Hoa en développant, déployant et faisant la
    promotion des logiciels libres issus de Hoa Project, de ses produits dérivés
    et des projets associés</blockquote></li>
  </ul>
</section>

<section class="chapter">
  <div>2</div>
</section>

<section>
  <h1>Bibliothèques</h1>

  <p>Avantages :</p>
  <ul>
    <li data-item="++">une tâche = une bibliothèque</li>
    <li data-item="++">abstraite</li>
    <li data-item="++">réutilisation de code</li>
    <li data-item="++">meilleures performances (cache, optimisation…)</li>
    <li data-item="++">assemblage (pas de « boîtes noires »)</li>
    <li data-item="++">maintenance facilitée</li>
  </ul>

  <p>Inconvénient :</p>
  <ul>
    <li data-item="--">non <em lang="en">full-stack</em></li>
  </ul>
</section>

<section>
  <h1>Hoa\Core</h1>

  <p>Architecture générale :</p>
  <div id="libraries_architecture" class="schema"></div>
  <script>
  Hoa.Document.onReady(function ( ) {

      var paper       = Hoa.Graph(Hoa.$('#libraries_architecture'), 610, 350);
      var core        = paper.rect( 10, 250, 590, 90, 3, 'Base du noyau');
      var exception   = paper.rect( 10, 150, 110, 90, 3, 'Exception');
      var consistency = paper.rect(130, 150, 110, 90, 3, 'Consistency');
      var protocol    = paper.rect(250, 150, 110, 90, 3, 'Protocol');
      var event       = paper.rect(370, 150, 110, 90, 3, 'Event');
      var other       = paper.rect(490, 150, 110, 90, 3, '…');
      var libraries   = paper.rect( 10,  10, 590, 90, 3, 'Bibliothèques');

  });
  </script>
</section>

<section>
  <h1>Protocole <code>hoa://</code></h1>

  <p>Format :
     <code>hoa://<em>Root</em>[/<em>Component</em>]*[#<em>anchor</em>]</code></p>
  <p>Abstrait l'accès à des ressources :</p>
  <ul>
    <li><code>hoa://Application</code>, à l'application</li>
    <li><code>hoa://Data</code>, aux données de l'application</li>
    <li><code>hoa://Library</code>, aux bibliothèques</li>
  </ul>
  <pre><code class="language-php">Hoa\Registry::set('foo', 'bar');
var_dump(resolve('hoa://Library/Registry#foo'));</code></pre>
  <pre><code class="language-php">require 'hoa://Data/Configuration/.Cache/Foo.php';</code></pre>
  <pre><code class="language-shell">$ hoa compiler:pp hoa://Library/Json/Grammar.pp &lt;( echo '[1, 2, 3]' ) -v dump</code></pre>
  <pre><code class="language-shell">$ hoa core:resolve --tree hoa://</code></pre>
</section>

<section>
  <h1>Événements &amp; écouteurs</h1>

  <p>Événements : asynchrones <small>(à l'enregistrement)</small>, anonymes
     <small>(à l'utilisation)</small>, large diffusion à travers des composants
     isolés</p>
  <pre><code class="language-php">event('hoa://Event/Exception')->attach(new Hoa\File\Write('Foo.log'));</code></pre>
  <p class="break">Écouteurs : synchrones <small>(à l'enregistrement)</small>,
     identifiés <small>(à l'utilisation)</small>, interactions proches entre un
     ou quelques composants</p>
  <pre><code class="language-php">$server = new Hoa\Websocket\Server(…);
$server->on('message', function ( Hoa\Core\Event\Bucket $bucket ) {

    $source = $bucket->getSource(); // instanceof Hoa\Core\Event\Source
    $data   = $bucket->getData();   // Array
});</code></pre>
</section>

<section>
  <h1>Consistence</h1>

  <p>Dans et entre les versions de PHP et Hoa :</p>
  <ul>
    <li><code>from</code>/<code>import</code>, manipule les classes</li>
    <li><code>dnew</code>, <em lang="en">dynamic new</em></li>
    <pre><code class="language-php">$object = dnew('(Symfony or Hoathis or Hoa)\Foo\Bar');</code></pre>
    <li>gestion des entités et des mots-clés (<code>entityExists</code>,
        <code>isKeyword</code>, <code>isIdentifier</code>…)</li>
    <li><code>xcallable</code>, supporte et étend les
        <em lang="en">callables</em> de PHP</li>
    <li>compatibilité pour les versions antérieures (e.g.
        <code>trait_exists</code> pour 5.3)</li>
    <li>etc.</li>
  </ul>
</section>

<section>
  <h1>Flux uniformisés</h1>

  <p>Flux de PHP très puissants (!), uniformisés à travers plusieurs API et
     interfaces de <code>Hoa\Stream</code> :</p>
  <ul>
    <li><code>In</code>, <code>Out</code>, <code>Bufferable</code>,
    <code>Lockable</code>, <code>Pathable</code>, <code>Pointable</code>,
    <code>Statable</code>, <code>Touchable</code>
    etc<small><small><code>able</code></small></small>.</li>
    <li>filtres : entre la source et votre programme</li>
    <li><em lang="en">wrappers</em> : <code>hoa://<em>…</em></code>,
        <code>afup://<em>…</em></code>
        etc<small><small>://</small></small>.</li>
    <li>flux composites : des flux qui embarquent des flux, e.g. un flux
        XML lit sur un flux fichier</li>
    <li>etc.</li>
  </ul>
  <p>Exemples : <code>Hoa\File</code>, <code>Hoa\Socket</code>,
     <code>Hoa\Http</code>…</p>
</section>

<section>
  <div>3</div>
</section>

<section>
  <h1>Hoa\Websocket</h1>

  <p>WebSocket, protocole réseau standardisé
     (<a href="https://tools.ietf.org/html/rfc6455">RFC6455</a>), full-duplex et
     bidirectionnel ; communication <em>via</em> TCP ;
     <em lang="en">handshake</em> <em>via</em> HTTP :</p>
  <ul>
    <li data-item="++">interactivité</li>
    <li data-item="++">temps-réel</li>
  </ul>
  <p><code>Hoa\Websocket</code> propose un client et un serveur !</p>
  <ul>
    <li>support de la RFC6455 et
        feu-<a href="https://tools.ietf.org/wg/hybi/draft-ietf-hybi-thewebsocketprotocol/">Hybi00</a>
        <small>(ancien standard)</small></li>
    <li>passe la <a href="http://autobahn.ws/testsuite/">suite de test
        Autobahn</a> <small>(utilisée par Mozilla, Google, Microsoft, Apache,
        Facebook, Red Hat…)</small></li>
  </ul>
</section>

<section>
  <h1>Un message WebSocket<sup>*</sup></h1>

  <pre style="background: none"> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-------+-+-------------+-------------------------------+
|F|R|R|R| <strong>opcode</strong>|M| Payload len |    Extended payload length    |
|I|S|S|S|  (4)  |A|     (7)     |             (16/64)           |
|N|V|V|V|       |S|             |   (if payload len==126/127)   |
| |1|2|3|       |K|             |                               |
+-+-+-+-+-------+-+-------------+ - - - - - - - - - - - - - - - +
|     Extended payload length continued, if payload len == 127  |
+ - - - - - - - - - - - - - - - +-------------------------------+
|                               |Masking-key, if MASK set to 1  |
+-------------------------------+-------------------------------+
| Masking-key (continued)       |          Payload Data         |
+-------------------------------- - - - - - - - - - - - - - - - +
:                     Payload Data continued ...                :
+ - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - +
|                     Payload Data continued ...                |
+---------------------------------------------------------------+</pre>
  <p><small><sup>*</sup>
     <a href="https://tools.ietf.org/html/rfc6455#section-5.2">5.2.
     <em lang="en">Base Framing Protocol</em></a></small></p>
</section>

<section>
  <h1>Un serveur WebSocket</h1>

  <p>Flux : <code>Hoa\Socket\Server</code> écoute
     <code>127.0.0.1:8889</code></p>
  <p>Écouteurs : <code>open</code>, <code>message</code>,
  <code>binary-message</code>, <code>ping</code>, <code>error</code> et
  <code>close</code></p>
  <p>Exemple d'un écho :</p>
  <pre><code class="language-php">$server = new Hoa\Websocket\Server(
    new Hoa\Socket\Server('tcp://127.0.01:8889')
);
$server->on('message', function ( Hoa\Core\Event\Bucket $bucket ) {

    $message = $bucket->getData()['message'];

    echo 'Message: ', $message, "\n";
    $bucket->getSource()->send($message);

    return;
});
$server->run();</code></pre>
</section>

<section>
  <h1>Un client WebSocket <small>(<code>.html</code>)</small></h1>

  <p class="tright">
    <button onclick="websocketFlip()">↻</button>
  </p>
  <div id="websocket_flip" class="flip-container" style="height: 380px">
    <div class="flipper">
      <div class="front">
        <pre><code class="language-markup">&lt;input type="text" id="input" placeholder="Message…" />
&lt;pre id="output">&lt;/pre>

&lt;script>
  var host   = 'ws://127.0.0.1:8889';
  var socket = null;
  var input  = document.getElementById('input');
  var output = document.getElementById('output');
  var print  = function ( message ) {

      var samp       = document.createElement('samp');
      samp.innerHTML = message + '\n';
      output.appendChild(samp);

      return;
  };

  input.addEventListener('keyup', function ( evt ) {

      if(13 === evt.keyCode) {

          var msg = input.value;

          if(!msg)
              return;

          try {

              socket.send(msg);
              input.value = '';
              input.focus();
          }
          catch ( e ) {

              console.log(e);
          }

          return;
      }
  });

  try {

      socket = new WebSocket(host);
      socket.onopen = function ( ) {

          print('connection is opened');
          input.focus();

          return;
      };
      socket.onmessage = function ( msg ) {

          print(msg.data);

          return;
      };
      socket.onclose = function ( ) {

          print('connection is closed');

          return;
      };
  }
  catch ( e ) {

      console.log(e);
  }
&lt;/script></code></pre>
      </div>
      <div class="back">
        <input type="text" id="websocket_flip_input" placeholder="Message…" />
        <pre id="websocket_flip_output" style="min-height: 300px"></pre>
      </div>
    </div>
  </div>

  <script>
    var websocketFlip;

    (function ( ) {

        var host   = 'ws://127.0.0.1:8889';
        var socket = null;
        var input  = Hoa.$('#websocket_flip_input');
        var output = Hoa.$('#websocket_flip_output');
        var print  = function ( message ) {

            var samp       = document.createElement('samp');
            samp.innerHTML = message + '\n';
            output.appendChild(samp);

            return;
        };

        input.addEventListener('keyup', function ( evt ) {

            if(13 === evt.keyCode) {

                var msg = input.value;

                if(!msg)
                    return;

                try {

                    socket.send(msg);
                    input.value = '';
                    input.focus();
                }
                catch ( e ) {

                    console.log(e);
                }

                return;
            }
        });

        websocketFlip = function ( ) {

            $('#websocket_flip').classList.toggle('toggle');

            if(null === socket || WebSocket.OPEN !== socket.readyState) {

                try {
                    socket = new WebSocket(host);
                    socket.onopen = function ( ) {

                        print('connection is opened');
                        input.focus();

                        return;
                    };
                    socket.onmessage = function ( msg ) {

                        print(msg.data);

                        return;
                    };
                    socket.onclose = function ( ) {

                        print('connection is closed');

                        return;
                    };
                }
                catch ( e ) {

                    console.log(e);
                }
            }
            else
                socket.close();
        }
    })()
  </script>
</section>

<section>
  <h1>Un client WebSocket <small>(<code>.php</code>)</small></h1>

  <p>Flux : <code>Hoa\Socket\Client</code> écoute <code>127.0.0.1:8889</code></p>
  <p>Écouteurs : les mêmes (hérités de <code>Hoa\Websocket\Connection</code>)</p>
  <p>Exemple en CLI d'un prompt qui envoie des messages :</p>
  <pre style="max-height: 300px"><code class="language-php">$readline = new Hoa\Console\Readline();
$client   = new Hoa\Websocket\Client(
    new Hoa\Socket\Client('tcp://127.0.0.1:8889')
);
$client->setHost('localhost');
$client->connect();

do {

    $line = $readline->readLine('> ');

    if(false === $line || 'quit' === $line)
        break;

    $client->send($line);

} while(true);</code></pre>
</section>

<section>
  <h1>Un serveur WebSocket</h1>

  <p>Exemple <del>d'un écho</del> de <em lang="en">broadcast</em> :</p>
  <pre data-line="9"><code class="language-php">$server = new Hoa\Websocket\Server(
    new Hoa\Socket\Server('tcp://127.0.01:8889')
);
$server->on('message', function ( Hoa\Core\Event\Bucket $bucket ) {

    $message = $bucket->getData()['message'];

    echo 'Message: ', $message, "\n";
    $bucket->getSource()->broadcast($message);

    return;
});
$server->run();</code></pre>
</section>

<section>
  <h1>Hoa\Console</h1>

  <p>Basée sur le standard
     <a href="http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-048.pdf">ECMA-48</a>
     et des API très proches de
     <a href="http://linux.org/">Linux</a>,
     <a href="http://freebsd.org/">FreeBSD</a> ou
     <a href="https://en.wikipedia.org/wiki/UNIX_System_V">System V</a></p>
  <ul>
    <li><code>Console</code>, socle commun</li>
    <li><code>Cursor</code>, pour manipuler le curseur</li>
    <li><code>Window</code>, pour manipuler la fenêtre</li>
    <li><code>GetOption</code>, pour manipuler les options d'une commande</li>
    <li><code>Readline</code>, pour une lecture avancée de ligne</li>
    <li><code>Processus</code>, pour manipuler des processus</li>
    <li>etc.</li>
  </ul>
</section>

<section>
  <h1>Jouer avec le curseur</h1>

  <pre><code class="language-php">use Hoa\Console\Cursor as Cursor;</code></pre>
  <p>Les couleurs :</p>
  <pre><code class="language-php">Cursor::colorize('underlined foreground(yellow) background(#932e2e)');
echo 'foo';
Cursor::colorize('!underlined background(normal)');
echo 'bar';
</code></pre>
  <p>Les déplacements :</p>
  <pre><code class="language-php">Cursor::save();
Cursor::hide();
Cursor::move('← ← ← ↓ ↓');
Cursor::clear('↔');
echo 'New line!';
Cursor::restore();
Cursor::show();</code></pre>
  <p>Mais aussi : <code>getPosition</code>, <code>moveTo</code>,
     <code>setStyle</code> etc.</p>
</section>

<section>
  <h1>Jouer avec la fenêtre</h1>

  <pre><code class="language-php">use Hoa\Console\Window as Window;</code></pre>
  <p>La taille et la position :</p>
  <pre><code class="language-php">Window::setSize(80, 50);
var_dump(Window::getPosition());</code></pre>
  <p>L'état :</p>
  <pre><code class="language-php">Window::minimize();
Window::restore();
Window::raise();
Window::lower();</code></pre>
  <p>Le contenu :</p>
  <pre><code class="language-php">Window::scroll('↑ ↑ ↑');
Window::refresh();</code></pre>
  <p>Mais aussi : <code>setTitle</code>, <code>getTitle</code>,
     <code>getLabel</code>, <code>copy</code> etc.</p>
</section>

<section>
  <h1>Lecture avancée de ligne</h1>

  <p>Opérations supportées : édition avancée, historique, auto-complétion et
     UTF-8 :</p>
  <ul>
    <li><kbd>↑</kbd> et <kbd>↓</kbd>, manipuler l'historique</li>
    <li><kbd>←</kbd> et <kbd>→</kbd>, déplacer le curseur sur la ligne</li>
    <li><kbd>Ctrl</kbd> + <kbd>A</kbd>, se déplacer au début,
        <kbd>E</kbd> en fin</li>
    <li><kbd>Ctrl</kbd> + <kbd>B</kbd>, se déplacer en arrière d'un mot,
         <kbd>F</kbd> en avant</li>
    <li><kbd>⌫</kbd>, supprimer un caractère</li>
    <li><kbd>Ctrl</kbd> + <kbd>W</kbd>, supprimer jusqu'au début du mot</li>
    <li><kbd>⇥</kbd>, pour auto-compléter le mot</li>
    <li><kbd>↵</kbd>, pour envoyer la ligne</li>
  </ul>
</section>

<section>
  <h1>Auto-complétion</h1>

  <p><code>Hoa\Console\Readline\Autocompletion\Word</code> avec la liste des
     fonctions PHP :</p>
  <pre><code class="language-php">$readline = new Hoa\Console\Readline();
$readline->setAutocompleter(new Hoa\Console\Readline\Autocompleter\Word(
    get_defined_functions()['internal']
));

do {

    $line = $readline->readLine('> ');

    if(false === $line || 'quit' === $line)
        break;

    echo $line, "\n";

} while(true);</code></pre>
  <p>Fonctionne avec un <em lang="en">pipe</em> ou une redirection !</p>
</section>

<section>
  <h1>Ajouter un raccourci</h1>

  <p>Inverser la casse de la ligne avec <kbd>Ctrl</kbd> + <kbd>R</kbd> :</p>
  <pre><code class="language-php">$readline->addMapping('\C-R', function ( Hoa\Console\Readline $self ) {

    // Clear the line.
    Hoa\Console\Cursor::clear('↔');
    echo $self->getPrefix();

    // Get the line text.
    $line = $self->getLine();

    // New line.
    $new  = null;

    // Loop over all characters.
    for($i = 0, $max = $self->getLineLength(); $i &lt; $max; ++$i) {

        $char = mb_substr($line, $i, 1);

        if($char === $lower = mb_strtolower($char))
            $new .= mb_strtoupper($char);
        else
            $new .= $lower;
    }

    // Set the new line.
    $self->setLine($new);

    // Set the buffer (and let the readline echoes or not).
    $self->setBuffer($new);

    // The readline will continue to read.
    return $self::STATE_CONTINUE;
});</code></pre>
</section>

<section>
  <h1>Processus</h1>

  <p>Exécution rapide :</p>
  <pre><code class="language-php">var_dump(Hoa\Console\Processus::execute('id -u -n');</code></pre>
  <p>Exécution « dynamique », écouteurs <code>start</code>, <code>stop</code>,
     <code>input</code>, <code>output</code> et <code>timeout</code> :</p>
  <pre><code class="language-php">$processus = new Hoa\Console\Processus($command);
$processus->on('input', function ( $bucket ) {

    $bucket->getSource()->writeAll(…);

    return false; // means to close the pipe.
});
$processus->on('output', function ( $bucket ) {

    echo $bucket->getData()['line'], "\n";
});
$processus->run();
  </code></pre>
</section>

<section>
  <h1>Hoa\Compiler</h1>

  <p>Analyser et manipuler des données textuelles</p>
  <p><code>Hoa\Compiler\Llk</code> est un compilateur de compilateurs :</p>
  <ul>
    <li>compile une grammaire en compilateur</li>
    <li>compilateur = analyseur lexical + analyseur syntaxique</li>
    <div id="compiler" class="verbatim schema"></div>
    <script>
    Hoa.Document.onReady(function ( ) {

        var paper    = Hoa.Graph(Hoa.$('#compiler'), 760, 180);
        var grid     = paper.grid(0, 0, 760, 180, 5, 2);
        var word     = grid.push(paper.rect(0, 0, 140, 80, 3, 'mot'), 0, 0);
        var sequence = grid.push(paper.rect(0, 0, 140, 80, 3, 'séquence'), 2, 0);
        var trace    = grid.push(paper.rect(0, 0, 140, 80, 3, 'résultat'), 4, 0);
        grid.push(paper.rect(0, 0, 140, 50, 3, 'abcdef'), 0, 1);
        grid.push(paper.rect(0, 0, 380, 50, 3, '[[a ⟼ …], [bc ⟼ …], [d ⟼ …], [ef ⟼ …]]'), 2, 1);
        grid.push(paper.rect(0, 0, 140, 50, 3, 'valide/invalide'), 4, 1);

        paper.link.between(word, sequence, 'analyseur lexical');
        paper.link.between(sequence, trace, 'analyseur syntaxique');
    });
    </script>
    <li>séquence valide transformée en AST (arbre)</li>
  </ul>
  <p>Grammaire écrite en langage PP <small>(langage maison)</small></p>
</section>

<section>
  <h1>Grammaire <small>simplifiée</small> de JSON</h1>

  <p>Lexèmes (unité lexicale, atomique) :</p>
  <pre style="max-height: 180px"><code class="language-pp">%skip   space          \s
// Scalars.
%token  true           true
%token  false          false
%token  null           null
// Strings.
%token  quote_         "        -> string
%token  string:string  [^"]+
%token  string:_quote  "        -> default
// Objects.
%token  brace_         {
%token _brace          }
// Arrays.
%token  bracket_       \[
%token _bracket        \]
// Rest.
%token  colon          :
%token  comma          ,
%token  number         \d+</code></pre>
  <p>Règles :</p>
  <pre style="max-height: 180px"><code class="language-pp">value:
    &lt;true> | &lt;false> | &lt;null> | string() | object() | array() | number()

string:
    ::quote_:: &lt;string> ::_quote::

number:
    &lt;number>

#object:
    ::brace_:: pair() ( ::comma:: pair() )* ::_brace::

#pair:
    string() ::colon:: value()

#array:
    ::bracket_:: value() ( ::comma:: value() )* ::_bracket::</code></pre>
</section>

<section>
  <h1>Analyser du JSON</h1>

  <p>Manuellement :</p>
  <pre style="max-height: 310px"><code class="language-php">// 1. Load grammar.
$compiler = Hoa\Compiler\Llk::load(new Hoa\File\Read('Json.pp'));

// 2. Parse a data.
$ast      = $compiler->parse('{"foo": true, "bar": [null, 42]}');

// 3. Dump the AST.
$dump     = new Hoa\Compiler\Visitor\Dump();
echo $dump->visit($ast);

/**
 * Will output:
 *     >  #object
 *     >  >  #pair
 *     >  >  >  token(string:string, foo)
 *     >  >  >  token(true, true)
 *     >  >  #pair
 *     >  >  >  token(string:string, bar)
 *     >  >  >  #array
 *     >  >  >  >  token(null, null)
 *     >  >  >  >  token(number, 42)
 */</code></pre>
  <p>En ligne de commande :</p>
  <pre><code class="language-shell">$ hoa compiler:pp Json.pp &lt;( echo '{"foo": true, "bar": [null, 42]}' ) -v dump</code></pre>
</section>

<section>
  <h1>Finaliser la compilation</h1>

  <p>Utiliser <code>Hoa\Visit</code> pour visiter l'arbre</p>
  <p>Opérations possibles :</p>
  <ul>
    <li><em lang="en">pretty-printer</em></li>
    <li>vérification de types</li>
    <li>optimisations diverses</li>
    <li>exécution<sup>*</sup></li>
    <li>transformation vers un autre langage (e.g. PHP, opcode, asm…)<sup>**</sup></li>
  </ul>
  <p class="break"><small><sup>*</sup> « interprétation »</small></p>
  <p><small><sup>**</sup> « compilation »</small></p>
</section>

<section>
  <h1>Génération de données</h1>

  <p><em lang="en">Grammar-based data generation</em> :</p>
  <ul>
    <li>article publié et présenté à
        <a href="https://sites.google.com/site/amost2012/">A-MOST 2012</a>,
        conférence internationale</li>
    <li>plusieurs algorithmes : isotropique, aléatoire et uniforme, exhaustive
        bornée, par couverture</li>
  </ul>
  <p>Exemple avec la grammaire des… <a href="http://pcre.org/">PCRE</a>
     <small>(voir <code>Hoa\Regex</code>)</small></p>
  <pre><code class="language-shell">$ hoa praspel:shell
// …
> regex: /fo{2,4}ba[rz]+/
> .sample regex
'foobazzz'
> .sample regex
'foooobazrzrzrzz'</code></pre>
</section>

<section>
  <h1>Hoa\Ruler</h1>

  <p>Bel exemple d'utilisation de <code>Hoa\Compiler</code>, par
     <a href="http://verylastroom.com/">VeryLastRoom</a></p>
  <p>Moteur de règles, écrites dans un langage dédié, proche d'SQL</p>
  <pre><code class="language-php">$ruler = new Hoa\Ruler();

// 1. Write a rule.
$rule  = 'group in ("customer", "guest") and points > 30';

// 2. Create a context.
$context           = new Hoa\Ruler\Context();
$context['group']  = 'customer';
$context['points'] = function ( ) {

    return 42;
};

// 3. Assert!
var_dump(
    $ruler->assert($rule, $context)
);</code></pre>
</section>

<section>
  <h1>Fonctionnement</h1>

  <div id="ruler" class="verbatim schema"></div>
  <script>
  Hoa.Document.onReady(function ( ) {

      var paper        = Hoa.Graph(Hoa.$('#ruler'), 780, 300);
      var grid         = paper.grid(0, 0, 780, 300, 6, 3);
      var rule         = grid.push(paper.rect(0, 0, 110, 80, 3, 'règle'), 0, 1);
      var compiler     = grid.push(paper.rect(0, 0, 110, 80, 3, 'AST'), 1, 1);
      var vinterpreter = grid.push(paper.rect(0, 0, 110, 80, 3, 'interpréteur'), 2, 1);
      var model        = grid.push(paper.rect(0, 0, 110, 80, 3, 'modèle'), 3, 1);
      var vasserter    = grid.push(paper.rect(0, 0, 110, 80, 3, 'asserteur'), 5, 0);
      var vcompiler    = grid.push(paper.rect(0, 0, 110, 80, 3, 'PHP code'), 5, 1);
      var vdisassembly = grid.push(paper.rect(0, 0, 110, 80, 3, 'règle'), 5, 2);

      paper.link.between(rule, compiler, '');
      paper.link.between(compiler, vinterpreter, '');
      paper.link.between(vinterpreter, model, '');
      paper.link.between(model, vasserter, '');
      paper.link.between(model, vcompiler, '');
      paper.link.between(model, vdisassembly, '');
  });
  </script>
  <p>Exemple de compilation vers PHP :</p>
  <pre><code class="language-php">$database->save(
    serialize(
        Hoa\Ruler::interprete(
            'logged(user) and group in ("customer", "guest") and points > 30'
        ) // rule → AST → interpreter → model
    ) // model → serialized
);</code></pre>
</section>

<section>
  <h1>Hoa\Praspel</h1>
</section>

<section>
  <h1>Hoathis\Atoum</h1>
</section>

<section>
  <h1>Symfony</h1>
</section>

<section>
  <h1>Sohoa</h1>
</section>


<div id="progress-bar"></div>

<script src="http://static.hoa-project.net/Javascript/Keynote.js"></script>
<script src="http://static.hoa-project.net/Javascript/Prism.js"></script>
<script src="http://static.hoa-project.net/Javascript/Prism.hoa.js"></script>
<script src="http://static.hoa-project.net/Javascript/Prism.plugin.line.js"></script>
<script src="http://static.hoa-project.net/Javascript/Hoa.Graph.js"></script>
<script src="http://static.hoa-project.net/Javascript/Hoa.Graph.style.js"></script>

</body>
</html>
